<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WORLD CLOCK</title>

  <link href="https://unpkg.com/cesium/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <script src="https://unpkg.com/cesium/Build/Cesium/Cesium.js"></script>

  <style>
    :root{
      --bg:#000;
      --red:#ff0000;
      --blue: rgb(0,0,255);
      --green: rgb(0,255,0);
      --white:#fff;

      --big: min(10vh, 120px);
      --tight: -0.6vh;

      --uiScale: 1;
      --topPad: 3vh;

      /* ✅ 글자 잘림 방지: safe-area 포함 + 기본값 더 여유있게 */
      --bottomSafe: max(160px, calc(env(safe-area-inset-bottom, 0px) + 24px));
      --sideSafe: 2.5vw;
    }

    html,body{
      margin:0; height:100%; background:var(--bg); overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
    }
    #cesiumContainer{ position:fixed; inset:0; }

    .center-line{
      position:fixed; left:50%; top:0; width:2px; height:100vh;
      background:rgba(255,255,255,0.85);
      transform:translateX(-50%);
      pointer-events:none; z-index:50;
    }

    /* ✅ top-ui는 위치만 담당 */
    .top-ui{
      position:fixed;
      left:50%;
      top: var(--topPad);
      transform: translateX(-50%);
      z-index:80;
      pointer-events:none;
      max-width: calc(100vw - (var(--sideSafe) * 2));
    }

    /* ✅ 실제 내용은 ui-inner에서 scale */
    .ui-inner{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:2.0vh;
      transform: scale(var(--uiScale));
      transform-origin: top center;
      will-change: transform;
    }

    .text-big{
      font-weight:800;
      font-size: var(--big);
      line-height: 1;
      letter-spacing: 0.02em;
      text-rendering: geometricPrecision;
      -webkit-font-smoothing: antialiased;
      text-align:center;
      white-space: nowrap;
    }

    .headline{ color: var(--white); }  /* ✅ 다시 한 줄 */
    /* ✅ 잘릴 때만 줄바꿈 허용 */
    .headline.is-wrapped{ white-space: pre-line; }

    .date{ color: var(--red); margin-top: var(--tight); }
    .digital{ color: var(--red); margin-top: var(--tight); }

    .lon{
      color: var(--blue);
      margin-top: var(--tight);
      text-shadow: 0 0 24px rgba(0,0,255,0.18);
      white-space: pre-line;
    }

    .place{
      color: var(--green);
      margin-top: var(--tight);
      text-shadow: 0 0 24px rgba(0,255,0,0.14);
      white-space: pre-line;

      /* ✅ “항상 2줄” 자리 확보 */
      min-height: calc((var(--big) * 2) + 1.2vh);
    }

    .clock{
      width:min(46vh, 520px);
      aspect-ratio:1/1;
      display:block;
    }

    /* ✅ 측정용(숨김) UI */
    .measure-wrap{
      position:fixed;
      left:-99999px;
      top:-99999px;
      visibility:hidden;
      pointer-events:none;
      z-index:-1;
    }

    @media (max-aspect-ratio: 3/4){
      :root{ --big: min(8vh, 92px); }
      .clock{ width:min(38vh, 440px); }
    }
  </style>
</head>

<body>
  <div id="cesiumContainer"></div>

  <div class="center-line"></div>

  <div class="top-ui">
    <div class="ui-inner" id="uiInner">
      <div class="text-big headline" id="headlineLine">EVERY DAY IS A NEW DAY</div>

      <!-- ✅ 시계 눈금(분 표시)용 g 추가 -->
      <svg class="clock" viewBox="0 0 100 100" aria-hidden="true">
        <g id="minuteTicks"></g>

        <circle cx="50" cy="50" r="40" fill="none" stroke="var(--red)" stroke-width="1.2"></circle>

        <!-- 12시 마커(원래 있던 짧은 선) -->
        <line x1="50" y1="10" x2="50" y2="18" stroke="var(--red)" stroke-width="1.6" stroke-linecap="round"></line>

        <!-- hands -->
        <line x1="50" y1="50" x2="50" y2="28" stroke="var(--red)" stroke-width="3.2" stroke-linecap="round"></line>
        <line x1="50" y1="50" x2="50" y2="20" stroke="var(--red)" stroke-width="2.2" stroke-linecap="round"></line>
        <circle cx="50" cy="50" r="2.2" fill="var(--red)"></circle>
      </svg>

      <div class="text-big date" id="dateLine">2026 FEB 01</div>
      <div class="text-big digital" id="timeLine">00:00:00</div>

      <div class="text-big lon" id="lonLine">LONGITUDE
000.000°E</div>

      <div class="text-big place" id="placeLine"></div>
    </div>
  </div>

  <!-- ✅ 측정용 복제 UI -->
  <div class="measure-wrap">
    <div class="ui-inner" id="uiMeasure">
      <div class="text-big headline" id="headlineMeasure">EVERY DAY IS A NEW DAY</div>

      <svg class="clock" viewBox="0 0 100 100" aria-hidden="true">
        <g></g>
        <circle cx="50" cy="50" r="40" fill="none" stroke="var(--red)" stroke-width="1.2"></circle>
        <line x1="50" y1="10" x2="50" y2="18" stroke="var(--red)" stroke-width="1.6" stroke-linecap="round"></line>
        <line x1="50" y1="50" x2="50" y2="28" stroke="var(--red)" stroke-width="3.2" stroke-linecap="round"></line>
        <line x1="50" y1="50" x2="50" y2="20" stroke="var(--red)" stroke-width="2.2" stroke-linecap="round"></line>
        <circle cx="50" cy="50" r="2.2" fill="var(--red)"></circle>
      </svg>

      <div class="text-big date" id="dateMeasure">2026 FEB 01</div>
      <div class="text-big digital">00:00:00</div>
      <div class="text-big lon" id="lonMeasure">LONGITUDE
000.000°E</div>

      <div class="text-big place" id="placeMeasure">대한민국
서울</div>
    </div>
  </div>

<script>
(async () => {
  Cesium.Ion.defaultAccessToken =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJkNWNmOTE0Yi0wMDAzLTQzNDAtYTg4NC02YjdmYTVkZjBlNDgiLCJpZCI6Mzg1ODc3LCJpYXQiOjE3Njk5Nzg5Njl9.tCSau-yKKszfHUbw8Ip_t2uRNyduPYBTDSpgeD2hxC4";

  const viewer = new Cesium.Viewer("cesiumContainer", {
    animation:false, timeline:false, baseLayerPicker:false, geocoder:false,
    homeButton:false, navigationHelpButton:false, sceneModePicker:false,
    fullscreenButton:false, selectionIndicator:false, infoBox:false,
    shouldAnimate:true
  });

  viewer.scene.skyAtmosphere.show = false;
  viewer.scene.skyBox.show = false;
  viewer.scene.sun.show = false;
  viewer.scene.moon.show = false;
  viewer.scene.fog.enabled = false;
  viewer.scene.backgroundColor = Cesium.Color.BLACK;
  viewer.scene.postProcessStages.fxaa.enabled = true;

  viewer.imageryLayers.removeAll();
  try{
    const provider = await Cesium.createWorldImageryAsync({
      style: Cesium.IonWorldImageryStyle.AERIAL
    });
    viewer.imageryLayers.addImageryProvider(provider);
  }catch(err){
    console.error("❌ Imagery load failed:", err);
  }

  const headlineEl = document.getElementById("headlineLine");
  const headlineMeasureEl = document.getElementById("headlineMeasure");

  const lonEl = document.getElementById("lonLine");
  const placeEl = document.getElementById("placeLine");
  const dateEl = document.getElementById("dateLine");
  const timeEl = document.getElementById("timeLine");

  const uiMeasure = document.getElementById("uiMeasure");
  const lonMeasure = document.getElementById("lonMeasure");
  const dateMeasure = document.getElementById("dateMeasure");

  /* ✅ 1) 시계 눈금(60분) 생성: 5분은 길게/굵게, 나머지는 짧게 */
  function buildMinuteTicks(){
    const g = document.getElementById("minuteTicks");
    if(!g) return;
    g.innerHTML = "";

    const cx = 50, cy = 50;
    const rOuter = 40;        // 원 테두리 반지름
    const rInnerMinor = 36.2; // 일반 분 눈금 시작
    const rInnerMajor = 34.2; // 5분(major) 눈금 시작

    for(let i=0;i<60;i++){
      const isMajor = (i % 5 === 0);

      const a = (i * 6) * Math.PI / 180; // 6deg per minute
      const sin = Math.sin(a), cos = Math.cos(a);

      const x2 = cx + sin * rOuter;
      const y2 = cy - cos * rOuter;

      const rIn = isMajor ? rInnerMajor : rInnerMinor;
      const x1 = cx + sin * rIn;
      const y1 = cy - cos * rIn;

      const line = document.createElementNS("http://www.w3.org/2000/svg","line");
      line.setAttribute("x1", x1.toFixed(3));
      line.setAttribute("y1", y1.toFixed(3));
      line.setAttribute("x2", x2.toFixed(3));
      line.setAttribute("y2", y2.toFixed(3));
      line.setAttribute("stroke", "var(--red)");
      line.setAttribute("stroke-linecap", "round");
      line.setAttribute("stroke-width", isMajor ? "1.6" : "1.0");
      line.setAttribute("opacity", isMajor ? "0.95" : "0.85");

      g.appendChild(line);
    }
  }
  buildMinuteTicks();

  /* ✅ 2) 헤드라인이 가로로 잘리면 "EVERY DAY\nIS A NEW DAY"로 변경 */
  function setHeadlineWrapped(isWrapped){
    if(isWrapped){
      headlineEl.textContent = "EVERY DAY\nIS A NEW DAY";
      headlineMeasureEl.textContent = "EVERY DAY\nIS A NEW DAY";
      headlineEl.classList.add("is-wrapped");
      headlineMeasureEl.classList.add("is-wrapped");
    }else{
      headlineEl.textContent = "EVERY DAY IS A NEW DAY";
      headlineMeasureEl.textContent = "EVERY DAY IS A NEW DAY";
      headlineEl.classList.remove("is-wrapped");
      headlineMeasureEl.classList.remove("is-wrapped");
    }
  }

  function getSideSafePx(){
    const rootStyle = getComputedStyle(document.documentElement);
    const v = rootStyle.getPropertyValue("--sideSafe").trim();
    // --sideSafe는 vw로 주고 있으니, 대충 처리: "2.5vw"면 innerWidth*0.025
    if(v.endsWith("vw")){
      const n = parseFloat(v) || 0;
      return window.innerWidth * (n/100);
    }
    return parseFloat(v) || 0;
  }

  function decideHeadlineWrap(){
    // 현재 스케일 기준으로 "자연폭" vs "자연허용폭" 비교
    const rootStyle = getComputedStyle(document.documentElement);
    const uiScale = parseFloat(rootStyle.getPropertyValue("--uiScale")) || 1;

    const sideSafe = getSideSafePx();
    const maxScreenW = window.innerWidth - (sideSafe * 2);
    const maxNaturalW = maxScreenW / uiScale;

    // 한 줄 버전으로 먼저 놓고 측정
    headlineMeasureEl.classList.remove("is-wrapped");
    headlineMeasureEl.textContent = "EVERY DAY IS A NEW DAY";

    const needWrap = (headlineMeasureEl.scrollWidth > maxNaturalW);
    setHeadlineWrapped(needWrap);
  }

  /* ✅ 어떤 화면에서도 절대 안 잘리게: 측정용 UI 기준으로 자동 축소 */
  function fitUI(){
    // 먼저 헤드라인 줄바꿈 여부 결정 → 그 상태로 "최대 높이" 재측정
    decideHeadlineWrap();

    document.documentElement.style.setProperty("--uiScale", "1");
    requestAnimationFrame(() => {
      const rootStyle = getComputedStyle(document.documentElement);
      const topPad = parseFloat(rootStyle.getPropertyValue("--topPad")) || 0;
      const bottomSafe = parseFloat(rootStyle.getPropertyValue("--bottomSafe")) || 64;

      const maxH = window.innerHeight - (bottomSafe + 8);
      const naturalH = uiMeasure.scrollHeight + topPad;

      const scale = Math.min(1, maxH / naturalH);
      document.documentElement.style.setProperty("--uiScale", String(scale));

      // 스케일 바뀌면 가로 허용폭도 바뀌니 한 번 더 확정
      requestAnimationFrame(() => decideHeadlineWrap());
    });
  }

  window.addEventListener("resize", () => {
    buildMinuteTicks(); // 혹시 DPI/스케일 변동 체감용
    fitUI();
  });

  setTimeout(fitUI, 0);
  setTimeout(fitUI, 200);
  setTimeout(fitUI, 600);

  function getMidnightOffsetHours(now){
    const utc = now.getUTCHours()
      + now.getUTCMinutes()/60
      + (now.getUTCSeconds() + now.getUTCMilliseconds()/1000)/3600;

    let offset = -utc;
    offset = ((offset % 24) + 24) % 24;
    if(offset > 12) offset -= 24;
    return offset;
  }
  function offsetToLongitude(offsetHours){ return offsetHours * 15; }
  function normLon180(lon){
    return ((lon + 180) % 360 + 360) % 360 - 180;
  }
  function lonEWText(lon180){
    const dir = lon180 >= 0 ? "E" : "W";
    const abs = Math.abs(lon180);
    const num = abs.toFixed(3).padStart(7, "0");
    return `${num}°${dir}`;
  }

  function formatMidnightDate(now){
    const offsetH = getMidnightOffsetHours(now);
    const shifted = new Date(now.getTime() + offsetH * 3600 * 1000);

    const Y = shifted.getUTCFullYear();
    const M = shifted.getUTCMonth();
    const D = shifted.getUTCDate();

    const MONTHS = ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];
    return `${Y} ${MONTHS[M]} ${String(D).padStart(2,"0")}`;
  }

  const CITIES = [
    { country:"세네갈", city:"다카르", lon:-17.4677 },
    { country:"모로코", city:"카사블랑카", lon:-7.5898 },
    { country:"가나", city:"아크라", lon:-0.1870 },
    { country:"나이지리아", city:"라고스", lon:3.3792 },
    { country:"튀니지", city:"튀니스", lon:10.1815 },
    { country:"이집트", city:"알렉산드리아", lon:29.9187 },
    { country:"이집트", city:"카이로", lon:31.2357 },
    { country:"에티오피아", city:"아디스아바바", lon:38.7578 },
    { country:"케냐", city:"나이로비", lon:36.8219 },
    { country:"탄자니아", city:"다르에스살람", lon:39.2083 },
    { country:"남아프리카공화국", city:"케이프타운", lon:18.4241 },
    { country:"남아프리카공화국", city:"요하네스버그", lon:28.0473 },

    { country:"아이슬란드", city:"레이캬비크", lon:-21.8277 },
    { country:"아일랜드", city:"더블린", lon:-6.2603 },
    { country:"영국", city:"런던", lon:-0.1278 },
    { country:"영국", city:"맨체스터", lon:-2.2426 },
    { country:"포르투갈", city:"리스본", lon:-9.1393 },
    { country:"스페인", city:"마드리드", lon:-3.7038 },
    { country:"스페인", city:"바르셀로나", lon:2.1734 },
    { country:"프랑스", city:"파리", lon:2.3522 },
    { country:"프랑스", city:"마르세유", lon:5.3698 },
    { country:"벨기에", city:"브뤼셀", lon:4.3517 },
    { country:"네덜란드", city:"암스테르담", lon:4.9041 },
    { country:"네덜란드", city:"로테르담", lon:4.4792 },
    { country:"독일", city:"함부르크", lon:9.9937 },
    { country:"독일", city:"베를린", lon:13.4050 },
    { country:"독일", city:"뮌헨", lon:11.5820 },
    { country:"스위스", city:"취리히", lon:8.5417 },
    { country:"이탈리아", city:"밀라노", lon:9.1900 },
    { country:"이탈리아", city:"로마", lon:12.4964 },
    { country:"이탈리아", city:"나폴리", lon:14.2681 },
    { country:"오스트리아", city:"비엔나", lon:16.3738 },
    { country:"체코", city:"프라하", lon:14.4378 },
    { country:"헝가리", city:"부다페스트", lon:19.0402 },
    { country:"폴란드", city:"바르샤바", lon:21.0122 },
    { country:"덴마크", city:"코펜하겐", lon:12.5683 },
    { country:"스웨덴", city:"스톡홀름", lon:18.0686 },
    { country:"노르웨이", city:"오슬로", lon:10.7522 },
    { country:"핀란드", city:"헬싱키", lon:24.9384 },
    { country:"그리스", city:"아테네", lon:23.7275 },
    { country:"루마니아", city:"부쿠레슈티", lon:26.1025 },
    { country:"우크라이나", city:"키이우", lon:30.5234 },
    { country:"러시아", city:"상트페테르부르크", lon:30.3351 },
    { country:"러시아", city:"모스크바", lon:37.6173 },

    { country:"이스라엘", city:"텔아비브", lon:34.7818 },
    { country:"레바논", city:"베이루트", lon:35.5018 },
    { country:"사우디아라비아", city:"리야드", lon:46.6753 },
    { country:"아랍에미리트", city:"아부다비", lon:54.3773 },
    { country:"아랍에미리트", city:"두바이", lon:55.2708 },
    { country:"카타르", city:"도하", lon:51.5310 },
    { country:"튀르키예", city:"이스탄불", lon:28.9784 },
    { country:"조지아", city:"트빌리시", lon:44.8271 },
    { country:"아제르바이잔", city:"바쿠", lon:49.8671 },
    { country:"이란", city:"테헤란", lon:51.3890 },
    { country:"우즈베키스탄", city:"타슈켄트", lon:69.2401 },
    { country:"카자흐스탄", city:"알마티", lon:76.9450 },

    { country:"파키스탄", city:"카라치", lon:67.0099 },
    { country:"인도", city:"뭄바이", lon:72.8777 },
    { country:"인도", city:"뉴델리", lon:77.2090 },
    { country:"인도", city:"첸나이", lon:80.2707 },
    { country:"스리랑카", city:"콜롬보", lon:79.8612 },
    { country:"방글라데시", city:"다카", lon:90.4125 },
    { country:"네팔", city:"카트만두", lon:85.3240 },

    { country:"미얀마", city:"양곤", lon:96.1951 },
    { country:"태국", city:"방콕", lon:100.5018 },
    { country:"캄보디아", city:"프놈펜", lon:104.9282 },
    { country:"베트남", city:"호치민", lon:106.6297 },
    { country:"베트남", city:"하노이", lon:105.8342 },
    { country:"말레이시아", city:"쿠알라룸푸르", lon:101.6869 },
    { country:"싱가포르", city:"싱가포르", lon:103.8198 },
    { country:"인도네시아", city:"자카르타", lon:106.8456 },
    { country:"필리핀", city:"마닐라", lon:120.9842 },

    { country:"중국", city:"베이징", lon:116.4074 },
    { country:"중국", city:"상하이", lon:121.4737 },
    { country:"중국", city:"홍콩", lon:114.1694 },
    { country:"대만", city:"타이베이", lon:121.5654 },
    { country:"대한민국", city:"서울", lon:126.9780 },
    { country:"대한민국", city:"부산", lon:129.0756 },
    { country:"일본", city:"오사카", lon:135.5023 },
    { country:"일본", city:"도쿄", lon:139.6503 },
    { country:"일본", city:"삿포로", lon:141.3545 },

    { country:"호주", city:"퍼스", lon:115.8605 },
    { country:"호주", city:"애들레이드", lon:138.6007 },
    { country:"호주", city:"멜버른", lon:144.9631 },
    { country:"호주", city:"시드니", lon:151.2093 },
    { country:"뉴질랜드", city:"오클랜드", lon:174.7633 },
    { country:"뉴질랜드", city:"웰링턴", lon:174.7772 },

    { country:"캐나다", city:"밴쿠버", lon:-123.1207 },
    { country:"캐나다", city:"캘거리", lon:-114.0719 },
    { country:"캐나다", city:"토론토", lon:-79.3832 },
    { country:"미국", city:"시애틀", lon:-122.3321 },
    { country:"미국", city:"샌프란시스코", lon:-122.4194 },
    { country:"미국", city:"로스앤젤레스", lon:-118.2437 },
    { country:"미국", city:"덴버", lon:-104.9903 },
    { country:"미국", city:"시카고", lon:-87.6298 },
    { country:"미국", city:"휴스턴", lon:-95.3698 },
    { country:"미국", city:"워싱턴DC", lon:-77.0369 },
    { country:"미국", city:"뉴욕", lon:-74.0060 },
    { country:"멕시코", city:"멕시코시티", lon:-99.1332 },
    { country:"쿠바", city:"아바나", lon:-82.3666 },
    { country:"콜롬비아", city:"보고타", lon:-74.0721 },
    { country:"페루", city:"리마", lon:-77.0428 },
    { country:"칠레", city:"산티아고", lon:-70.6693 },
    { country:"아르헨티나", city:"부에노스아이레스", lon:-58.3816 },
    { country:"브라질", city:"리우데자네이루", lon:-43.1729 },
    { country:"브라질", city:"상파울루", lon:-46.6333 }
  ];

  function lonDiffDeg(a, b){
    let d = Math.abs(a - b);
    if(d > 180) d = 360 - d;
    return d;
  }
  function getCandidateCitiesByLongitude(passingLon180){
    const THRESH = 2.0;
    const withDist = CITIES.map(c => ({...c, d: lonDiffDeg(passingLon180, c.lon)}));
    return withDist.filter(c => c.d <= THRESH).sort((a,b)=>a.d-b.d);
  }

  const CAM_LAT = 0;
  const CAM_RANGE = 15_000_000;
  const CAM_PITCH = Cesium.Math.toRadians(-90);
  const CAM_HEADING = Cesium.Math.toRadians(0);

  function setCameraToLon(lonDeg){
    const target = Cesium.Cartesian3.fromDegrees(lonDeg, CAM_LAT, 0);
    const offset = new Cesium.HeadingPitchRange(CAM_HEADING, CAM_PITCH, CAM_RANGE);
    viewer.camera.lookAt(target, offset);
  }
  setCameraToLon(0);

  function animate(){
    const now = new Date();

    const offsetH = getMidnightOffsetHours(now);
    const midnightLon = offsetToLongitude(offsetH);
    const passingLon = normLon180(midnightLon);

    setCameraToLon(midnightLon);

    const lonText = `LONGITUDE\n${lonEWText(passingLon)}`;
    lonEl.textContent = lonText;
    lonMeasure.textContent = lonText;

    const dateText = formatMidnightDate(now);
    dateEl.textContent = dateText;
    dateMeasure.textContent = dateText;

    timeEl.textContent = "00:00:00";

    const candidates = getCandidateCitiesByLongitude(passingLon);
    const sec = Math.floor(now.getTime()/1000);

    if(!candidates.length){
      placeEl.textContent = "";
    }else{
      const idx = sec % candidates.length;
      const chosen = candidates[idx];
      placeEl.textContent = `${chosen.country}\n${chosen.city}`;
    }

    // ✅ “항상 전체가 보이게” 보장
    fitUI();

    requestAnimationFrame(animate);
  }

  fitUI();
  animate();
})();
</script>
</body>
</html>
