<!doctype html>

<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>WORLD CLOCK</title>

    <link href="https://unpkg.com/cesium/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
    <script src="https://unpkg.com/cesium/Build/Cesium/Cesium.js"></script>

    <style>
      @font-face{
        font-family: "FranklinGothicPencildrawn";
        src: url("FranklinGothicPencildrawn-ExtraCond.woff2") format("woff2");
        font-weight: 800;
        font-style: normal;
        font-display: swap;
      }

      @font-face{
        font-family: "MrsEavesPencildrawnBold-Overcooked";
        src: url("MrsEavesPencildrawnBold-Overcooked.woff2") format("woff2");
        font-weight: 700;
        font-style: normal;
        font-display: swap;
      }

      :root{
        --bg:#000;
        --white:#fff;
        --red:#ff0000;
        --blue:rgb(0,0,255);
        --green:rgb(0,255,0);
        --yellow:rgb(255,255,0);
        --black: rgb(0,0,0);

        --big: min(10vh, 120px);
        --headlineScale: 0.8;
        --infoScale: 0.6;

        --sideSafe: 2.5vw;
        --topPad: 3vh;

        --clockcolour: var(--white);
        --centerline: var(--red);
        --longitudecolour: var(--red);
        --locationcolour: var(--white);
      }

      html,body{
        margin:0;
        height:100%;
        background:var(--bg);
        overflow:hidden;
        font-family: "FranklinGothicPencildrawn", sans-serif;
      }

      #cesiumContainer{
        position:fixed;
        inset:0;
      }

      /* ================= CENTER LINE ================= */
      .center-line{
        position:fixed;
        left:50%;
        top:0;
        width:2px;
        height:100vh;
        background:var(--centerline);
        transform:translateX(-50%);
        pointer-events:none;
        z-index:30;
      }

      /* ================= HEADLINE ================= */
      .headline-wrap{
        position:fixed;
        left:50%;
        top:var(--topPad);
        transform:translateX(-50%) scale(var(--headlineScale));
        transform-origin: top center;

        width:max-content;
        max-width:none;
        text-align:center;
        pointer-events:none;
        z-index:80;
      }

      /* ================= HEADLINE LAYOUT ================= */
      .headline{
        font-weight:800;
        font-size:var(--big);
        line-height: 1.0;
        letter-spacing:0.05em;
        color:var(--white);

        text-rendering:geometricPrecision;
        -webkit-font-smoothing:antialiased;

        display:inline-block;
        text-align:center;

        white-space:nowrap;
        word-break:keep-all;
      }

      .headline.is-wrapped br{ display:block; }
      .headline br{ display:block; }

      /* ====== FLOATING HEADLINE LETTERS ====== */
      .headline{
        display:inline-block;
      }

      .headline .ch{
        display:inline-block;
        will-change: transform;
        transform-origin: 50% 60%;
      }

      .headline .sp{
        display:inline-block;
        width:0.25em;
      }

      /* ================= CLOCK ================= */
      .center-clock{
        position:fixed;
        left:50%;
        top:50%;
        transform:translate(-50%,-50%);
        width:min(46vh,520px);
        aspect-ratio:1/1;
        pointer-events:none;
        z-index:60;
        overflow: visible;
      }

      .center-clock text{
        text-anchor: middle;
        dominant-baseline: middle;
        text-rendering: geometricPrecision;
        -webkit-font-smoothing: antialiased;
      }

      /* ================= BOTTOM INFO ================= */
      .bottom-ui{
        position:fixed;
        left:50%;
        bottom:4vh;
        transform:translateX(-50%) scale(var(--infoScale));
        transform-origin:bottom center;

        display:flex;
        flex-direction:column;
        align-items:center;
        gap:0em;

        pointer-events:none;
        z-index:90;
        max-width:calc(100vw - (var(--sideSafe) * 2));
      }

      /* ================= BOTTOM INFO LAYOUT ================= */
      .info-line{
        font-weight:800;
        font-size:var(--big);
        line-height:1;
        letter-spacing:0.02em;
        white-space:nowrap;
        text-align:center;
        text-rendering:geometricPrecision;
        -webkit-font-smoothing:antialiased;
      }

      /* ================= BOTTOM INFO FONT ================= */
      .bottom-ui .info-line{
        font-family: "MrsEavesPencildrawnBold-Overcooked", serif;
        font-weight: 700;
      }

      /* ================= BOTTOM INFO TEXT COLOUR ================= */
      .info-line.lon{
        color:var(--longitudecolour);
      }
      .info-line.place{
        color:var(--locationcolour);
      }

      /* ================= RESPONSIVE ================= */
      @media (max-aspect-ratio:3/4){
        :root{ --big: min(8vh, 92px); }
        .center-clock{ width:min(38vh,440px); }
      }
    </style>
  </head>

    <body>
      <div id="cesiumContainer"></div>
      <div class="center-line"></div>

      <!-- HEADLINE -->
      <div class="headline-wrap">
        <div class="headline is-wrapped" id="headlineLine">
          EVERY DAY<br>IS<br>A NEW DAY
        </div>
      </div>

      <!-- CLOCK -->
      <svg class="center-clock" viewBox="-12 -12 124 124" aria-hidden="true">
        <g id="minuteTicks"></g>

        <!-- ===== CURVED DATE / TIME ===== -->
        <defs>
          <!-- 위쪽 반원 -->
          <path id="arcTop" d="M 8 50 A 42 42 0 0 1 92 50" />
          <!-- 아래쪽 반원 (방향 반대로 해서 글자 뒤집힘 방지) -->
          <path id="arcBottom" d="M 92 50 A 42 42 0 0 1 8 50" />
        </defs>

        <!-- ===== STRAIGHT TIME + DATE (below clock) ===== -->
        <g id="belowTextGroup">
          <!-- 1st line: time -->
          <text id="timeLineText"
                x="50" y="106"
                text-anchor="middle"
                fill="var(--clockcolour)"
                font-size="20"
                >
            Loading…
          </text>

          <!-- 2nd line: date -->
          <text id="dateLineText"
                x="50" y="122"
                text-anchor="middle"
                fill="var(--clockcolour)"
                font-size="10"
                >
            Loading…
          </text>
        </g>

        <circle cx="50" cy="50" r="40" fill="none"
          stroke="var(--clockcolour)" stroke-width="1.2"></circle>

        <line x1="50" y1="10" x2="50" y2="18"
          stroke="var(--clockcolour)" stroke-width="1.6" stroke-linecap="round"></line>

        <!-- hands (00:00 fixed) -->
        <line x1="50" y1="50" x2="50" y2="28"
          stroke="var(--clockcolour)" stroke-width="3.2" stroke-linecap="round"></line>
        <line x1="50" y1="50" x2="50" y2="20"
          stroke="var(--clockcolour)" stroke-width="2.2" stroke-linecap="round"></line>

        <circle cx="50" cy="50" r="2.2" fill="var(--clockcolour)"></circle>
      </svg>

      <!-- BOTTOM INFO -->
      <div class="bottom-ui">
        <div class="info-line lon" id="lonLine">Loading…</div>
        <div class="info-line place" id="placeLine">Loading…</div>
      </div>

      <script>
        (async () => {
          Cesium.Ion.defaultAccessToken =
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJkNWNmOTE0Yi0wMDAzLTQzNDAtYTg4NC02YjdmYTVkZjBlNDgiLCJpZCI6Mzg1ODc3LCJpYXQiOjE3Njk5Nzg5Njl9.tCSau-yKKszfHUbw8Ip_t2uRNyduPYBTDSpgeD2hxC4";

          const viewer = new Cesium.Viewer("cesiumContainer", {
            animation:false, timeline:false, baseLayerPicker:false, geocoder:false,
            homeButton:false, navigationHelpButton:false, sceneModePicker:false,
            fullscreenButton:false, selectionIndicator:false, infoBox:false,
            shouldAnimate:true
          });

          viewer.scene.skyAtmosphere.show = false;
          viewer.scene.skyBox.show = false;
          viewer.scene.sun.show = false;
          viewer.scene.moon.show = false;
          viewer.scene.fog.enabled = false;
          viewer.scene.backgroundColor = Cesium.Color.BLACK;

          viewer.imageryLayers.removeAll();
          const provider = await Cesium.createWorldImageryAsync({
            style: Cesium.IonWorldImageryStyle.AERIAL
          });
          viewer.imageryLayers.addImageryProvider(provider);

          /* ===== minute ticks ===== */
          const tickGroup = document.getElementById("minuteTicks");

          for(let i=0;i<60;i++){
            const major = i % 5 === 0;
            const a = i * 6 * Math.PI / 180;
            const sin = Math.sin(a), cos = Math.cos(a);

            const rOuter = 40;
            const rInner = major ? 34.2 : 36.2;

            const line = document.createElementNS("http://www.w3.org/2000/svg","line");
            line.setAttribute("x1", 50 + sin * rInner);
            line.setAttribute("y1", 50 - cos * rInner);
            line.setAttribute("x2", 50 + sin * rOuter);
            line.setAttribute("y2", 50 - cos * rOuter);
            line.setAttribute("stroke", "var(--clockcolour)");
            line.setAttribute("stroke-width", major ? "1.6" : "1.0");
            line.setAttribute("stroke-linecap","round");
            line.setAttribute("opacity", major ? "0.95" : "0.85");
            tickGroup.appendChild(line);
          }

          /* ===== UI refs ===== */
          const lonEl = document.getElementById("lonLine");
          const placeEl = document.getElementById("placeLine");

          const timeLineEl = document.getElementById("timeLineText");
          const dateLineEl = document.getElementById("dateLineText");

          /* ====== headline letters split + float ====== */
          const headlineEl = document.getElementById("headlineLine");

          function splitHeadlineToSpans(el){
            const raw = el.innerHTML;
            const lines = raw
              .split(/<br\s*\/?>/i)
              .map(s => s.replace(/&nbsp;/g, " ").replace(/\s+/g, " ").trim());

            el.innerHTML = "";
            const letters = [];

            for(let li = 0; li < lines.length; li++){
              const line = lines[li];

              for(const ch of line){
                if(ch === " "){
                  const sp = document.createElement("span");
                  sp.className = "sp";
                  sp.textContent = " ";
                  el.appendChild(sp);
                  continue;
                }

                const s = document.createElement("span");
                s.className = "ch";
                s.textContent = ch;
                el.appendChild(s);

                const seed = Math.random() * 1000;
                letters.push({
                  el: s,
                  seed,
                  ampX: 2 + Math.random() * 6,
                  ampY: 2 + Math.random() * 10,
                  ampR: 0.5 + Math.random() * 2.5,
                  spdX: 0.12 + Math.random() * 0.25,
                  spdY: 0.10 + Math.random() * 0.22,
                  spdR: 0.08 + Math.random() * 0.20,
                  phX: Math.random() * Math.PI * 2,
                  phY: Math.random() * Math.PI * 2,
                  phR: Math.random() * Math.PI * 2
                });
              }

              if(li < lines.length - 1){
                el.appendChild(document.createElement("br"));
              }
            }

            return letters;
          }

          const headlineLetters = splitHeadlineToSpans(headlineEl);

          function animateHeadlineLetters(){
            // 시간(초)
            const t = performance.now() / 1000;

            for(const L of headlineLetters){
              // 부드러운 무중력: sin/cos 섞어서 랜덤하지만 매끈하게
              const x = Math.sin(t * L.spdX + L.phX + L.seed) * L.ampX
                      + Math.sin(t * (L.spdX * 0.37) + L.phX * 1.7) * (L.ampX * 0.35);

              const y = Math.cos(t * L.spdY + L.phY + L.seed * 0.8) * L.ampY
                      + Math.sin(t * (L.spdY * 0.41) + L.phY * 1.3) * (L.ampY * 0.25);

              const r = Math.sin(t * L.spdR + L.phR + L.seed * 0.6) * L.ampR
                      + Math.cos(t * (L.spdR * 0.53) + L.phR * 1.1) * (L.ampR * 0.35);

              L.el.style.transform = `translate(${x.toFixed(2)}px, ${y.toFixed(2)}px) rotate(${r.toFixed(2)}deg)`;
            }
          }

          /* ===== helpers ===== */
          function getMidnightOffsetHours(now){
            const utc =
              now.getUTCHours() +
              now.getUTCMinutes()/60 +
              (now.getUTCSeconds()+now.getUTCMilliseconds()/1000)/3600;

            let offset = -utc;
            offset = ((offset % 24) + 24) % 24;
            if(offset > 12) offset -= 24;
            return offset;
          }
          
          function offsetToLongitude(h){
            return h * 15;
          }
          
          function normLon180(lon){
            return ((lon + 180) % 360 + 360) % 360 - 180;
          }

          function getMidnightShiftedUTC(now){
            const offsetH = getMidnightOffsetHours(now);
            return new Date(now.getTime() + offsetH * 3600 * 1000);
          }

          function formatMidnightDate(now){
            const shifted = getMidnightShiftedUTC(now);

            const Y = shifted.getUTCFullYear();
            const M = shifted.getUTCMonth();
            const D = shifted.getUTCDate();
            const W = shifted.getUTCDay(); // 0=Sun

            const WEEKDAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
            const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];

            // 요일, 날짜, 월, 년
            return `${WEEKDAYS[W]} ${String(D).padStart(2,"0")} ${MONTHS[M]} ${Y}`;
          }

          function formatMidnightTime(){
            return `00:00:00`;
          }

          function formatLongitudeDecimal4(lon180){
            const dir = lon180 >= 0 ? "E" : "W";
            const abs = Math.abs(lon180);
            const num = abs.toFixed(4).padStart(8,"0");
            return `Longitude ${num}°${dir}`;
          }

          function lerp(a,b,t){
            return a + (b-a) * t;
          }

          const CITIES = [
            { country:"Senegal", city:"Dakar", lon:-17.3000, lat:14.7319 },
            { country:"Morocco", city:"Casablanca", lon:-7.5898, lat:33.5992 },
            { country:"Ghana", city:"Accra", lon:-0.1870, lat:5.6037 },
            { country:"Nigeria", city:"Lagos", lon:3.3792, lat:6.4500 },
            { country:"Tunisia", city:"Tunis", lon:10.1815, lat:36.8008 },
            { country:"Egypt", city:"Alexandria", lon:29.9187, lat:31.2001 },
            { country:"Egypt", city:"Cairo", lon:31.2357, lat:30.0444 },
            { country:"Egypt", city:"Cairo", lon:34.7817, lat:30.0444 },
            { country:"Ethiopia", city:"Addis Ababa", lon:38.7578, lat:9.0300 },
            { country:"Kenya", city:"Nairobi", lon:36.8219, lat:-1.2864 },
            { country:"Tanzania", city:"Dar Es Salaam", lon:39.2083, lat:-6.8000 },
            { country:"South Africa", city:"Cape Town", lon:18.4241, lat:-33.9258 },
            { country:"South Africa", city:"Johannesburg", lon:28.0473, lat:-26.2044 },
            { country:"Mauritania", city:"Nouadhibou", lon:-16.0362, lat:20.9425 },
            { country:"Mauritania", city:"Nouadhibou", lon:-11.0362, lat:20.9425 },
            { country:"Mauritania", city:"Nouadhibou", lon:-9.1394, lat:20.9425 },

            { country:"Greenland", city:"Tasiilaq", lon:-41.0000, lat:65.6135 },
            { country:"Greenland", city:"Tasiilaq", lon:-39.0000, lat:66.6135 },
            { country:"Greenland", city:"Tasiilaq", lon:-37.6336, lat:67.0135 },
            { country:"Greenland", city:"Tasiilaq", lon:-34.0000, lat:67.0135 },
            { country:"Greenland", city:"Tasiilaq", lon:-33.9999, lat:69.0135 },
            { country:"Greenland", city:"Ittoqqortoormiit", lon:-24.0001, lat:69.6135 },

            { country:"Iceland", city:"Vestfirðir", lon:-24.0000, lat:65.6196 },
            { country:"Iceland", city:"Vestfirðir", lon:-22.5277, lat:65.6196 },
            { country:"Iceland", city:"Reykjavík", lon:-21.8277, lat:64.1451 },
            { country:"Iceland", city:"Akureyri", lon:-17.3001, lat:65.6826 },
            { country:"Ireland", city:"Dublin", lon:-6.2603, lat:53.3331 },
            { country:"United Kingdom", city:"London", lon:-0.1278, lat:51.5072 },
            { country:"United Kingdom", city:"London", lon:0.0000, lat:51.3072 },
            { country:"United Kingdom", city:"Manchester", lon:-2.2426, lat:53.4794 },
            { country:"Portugal", city:"Lisbon", lon:-9.1393, lat:38.7452 },
            { country:"Portugal", city:"Lisbon", lon:-7.5899, lat:38.7452 },
            { country:"Spain", city:"Madrid", lon:-3.7038, lat:40.4167 },
            { country:"Spain", city:"Madrid", lon:-6.2602, lat:40.4167 },
            { country:"Spain", city:"Barcelona", lon:2.1734, lat:41.3829 },
            { country:"France", city:"Paris", lon:2.3522, lat:48.8566 },
            { country:"France", city:"Marseille", lon:5.3698, lat:43.2964 },
            { country:"Belgium", city:"Brussels", lon:4.3517, lat:50.8467 },
            { country:"Netherlands", city:"Amsterdam", lon:4.9041, lat:52.3728 },
            { country:"Netherlands", city:"Rotterdam", lon:4.4792, lat:51.9225 },
            { country:"Netherlands", city:"Arnhem", lon:5.8987, lat:51.9851 },
            { country:"Germany", city:"Hamburg", lon:9.9937, lat:53.5500 },
            { country:"Germany", city:"Berlin", lon:13.4050, lat:52.5167 },
            { country:"Germany", city:"Munich", lon:11.5820, lat:48.1372 },
            { country:"Switzerland", city:"Zürich", lon:8.5417, lat:47.3786 },
            { country:"Italy", city:"Milan", lon:9.1900, lat:45.4669 },
            { country:"Italy", city:"Rome", lon:12.4964, lat:41.8931 },
            { country:"Italy", city:"Naples", lon:14.2681, lat:41.0333 },
            { country:"Austria", city:"Vienna", lon:16.3738, lat:48.2083 },
            { country:"Czech Republic", city:"Prague", lon:14.4378, lat:50.0833 },
            { country:"Hungary", city:"Budapest", lon:19.0402, lat:47.4983 },
            { country:"Poland", city:"Warsaw", lon:21.0122, lat:52.2333 },
            { country:"Denmark", city:"Copenhagen", lon:12.5683, lat:55.6761 },
            { country:"Sweden", city:"Stockholm", lon:18.0686, lat:59.3294 },
            { country:"Norway", city:"Oslo", lon:10.7522, lat:59.9133 },
            { country:"Norway", city:"Oslo", lon:10.1816, lat:59.9133 },
            { country:"Finland", city:"Helsinki", lon:24.9384, lat:60.1756 },
            { country:"Greece", city:"Athens", lon:23.7275, lat:37.9842 },
            { country:"Romania", city:"Bucharest", lon:26.1025, lat:44.4325 },
            { country:"Ukraine", city:"Kyiv", lon:30.5234, lat:50.4500 },
            { country:"Russia", city:"Saint Petersburg", lon:30.3351, lat:59.9390 },
            { country:"Russia", city:"Moscow", lon:37.6173, lat:55.7558 },
            { country:"Russia", city:"Kamchatka Krai", lon:168.7884, lat:65.4344 },
            { country:"Russia", city:"Kamchatka Krai", lon:151.2094, lat:65.4344 },
            { country:"Russia", city:"Chukotka Autonomous Okrug", lon:174.7773, lat:65.6298 },
            { country:"Russia", city:"Chukotka Autonomous Okrug", lon:179.0000, lat:67.6298 },
            { country:"Russia", city:"Chukotka Autonomous Okrug", lon:-175.0000, lat:66.1298 },
            { country:"Russia", city:"Chukotka Autonomous Okrug", lon:-171.0000, lat:66.1298 },

            { country:"Israel", city:"Tel Aviv", lon:34.7818, lat:32.0800 },
            { country:"Lebanon", city:"Beirut", lon:35.5018, lat:33.8869 },
            { country:"Saudi Arabia", city:"Riyadh", lon:46.6753, lat:24.6408 },
            { country:"United Arab Emirates", city:"Abu Dhabi", lon:54.3773, lat:23.4511 },
            { country:"United Arab Emirates", city:"Dubai", lon:55.2708, lat:24.2697 },
            { country:"Qatar", city:"Doha", lon:51.5310, lat:25.2867 },
            { country:"Turkey", city:"Istanbul", lon:28.9784, lat:41.0100 },
            { country:"Turkey", city:"Diyarbakir", lon:40.211, lat:37.925 },
            { country:"Georgia", city:"Tbilisi", lon:44.8271, lat:41.7225 },
            { country:"Azerbaijan", city:"Baku", lon:49.8671, lat:40.3667 },
            { country:"Iran", city:"Tehran", lon:51.3890, lat:35.7000 },
            { country:"Uzbekistan", city:"Tashkent", lon:69.2401, lat:41.3111 },
            { country:"Kazakhstan", city:"Almaty", lon:76.9450, lat:43.2775 },
            { country:"Kazakhstan", city:"Mangyshlak Peninsula", lon:52.2500, lat:43.5000 },

            { country:"Pakistan", city:"Karachi", lon:67.0099, lat:26.8600 },
            { country:"Pakistan", city:"Karachi", lon:55.2709, lat:27.8600 },
            { country:"India", city:"Mumbai", lon:72.8777, lat:29.0758 },
            { country:"India", city:"New Delhi", lon:77.2090, lat:28.6667 },
            { country:"India", city:"Chennai", lon:80.2707, lat:13.0825 },
            { country:"India", city:"Chennai", lon:79.8613, lat:13.0825 },
            { country:"Sri Lanka", city:"Colombo", lon:79.8612, lat:11.9167 },
            { country:"Bangladesh", city:"Dhaka", lon:90.4125, lat:23.7289 },
            { country:"Nepal", city:"Kathmandu", lon:85.3240, lat:27.7167 },
            { country:"Nepal", city:"Kathmandu", lon:80.2708, lat:27.7167 },

            { country:"Myanmar", city:"Yangon", lon:96.1951, lat:20.7950 },
            { country:"Thailand", city:"Bangkok", lon:100.5018, lat:13.7500 },
            { country:"Cambodia", city:"Phnom Penh", lon:104.9282, lat:11.5696 },
            { country:"Vietnam", city:"Ho Chi Minh City", lon:106.6297, lat:10.8167 },
            { country:"Vietnam", city:"Hanoi", lon:105.8342, lat:21.0283 },
            { country:"Malaysia", city:"Kuala Lumpur", lon:101.6869, lat:3.1478 },
            { country:"Singapore", city:"Singapore", lon:103.8198, lat:1.8000 },
            { country:"Indonesia", city:"Jakarta", lon:106.8456, lat:-7.2146 },
            { country:"Philippines", city:"Manila", lon:120.9842, lat:14.6000 },
            { country:"Mongolia", city:"Khalkhgol", lon:119.6224, lat:47.6270 },

            { country:"China", city:"Beijing", lon:116.4074, lat:39.9040 },
            { country:"China", city:"Beijing", lon:114.1695, lat:39.9040 },
            { country:"China", city:"Shanghai", lon:121.4737, lat:31.1667 },
            { country:"China", city:"Hong Kong", lon:114.1694, lat:22.3069 },
            { country:"China", city:"Shenyang", lon:124.4330, lat:41.8048 },
            { country:"China", city:"Shenyang", lon:122.4330, lat:41.8048 },
            { country:"Taiwan", city:"Taipei", lon:121.5654, lat:25.0478 },
            { country:"South Korea", city:"Seoul", lon:126.9780, lat:37.5600 },
            { country:"South Korea", city:"Busan", lon:129.0756, lat:36.1667 },
            { country:"North Korea", city:"Pyongyang", lon:125.8198, lat:39.0738 },
            { country:"Japan", city:"Nagasaki", lon:129.8779, lat:32.8003 },
            { country:"Japan", city:"Osaka", lon:133.5023, lat:34.6937 },
            { country:"Japan", city:"Osaka", lon:138.6006, lat:34.6937 },
            { country:"Japan", city:"Kyoto", lon:135.7681, lat:35.0116 },
            { country:"Japan", city:"Tokyo", lon:139.6503, lat:35.6839 },
            { country:"Japan", city:"Sapporo", lon:141.3545, lat:43.0621 },

            { country:"Australia", city:"Adelaide", lon:138.6007, lat:-34.9289 },
            { country:"Australia", city:"Melbourne", lon:144.9631, lat:-37.8136 },
            { country:"Australia", city:"Sydney", lon:151.2093, lat:-33.8650 },
            { country:"New Zealand", city:"Auckland", lon:174.7633, lat:-41.8406 },
            { country:"New Zealand", city:"Auckland", lon:170.7633, lat:-43.8406 },
            { country:"New Zealand", city:"Wellington", lon:174.7772, lat:-41.3000 },

            { country:"Canada", city:"Vancouver", lon:-123.1207, lat:49.2500 },
            { country:"Canada", city:"Calgary", lon:-114.0719, lat:51.0500 },
            { country:"Canada", city:"Toronto", lon:-79.3832, lat:44.0417 },
            { country:"United States", city:"Alaska", lon:-123.2000, lat:63.5888 },
            { country:"United States", city:"Alaska", lon:-154.4931, lat:63.5888 },
            { country:"United States", city:"Alaska", lon:-160.0000, lat:65.5888 },
            { country:"United States", city:"Alaska", lon:-168.0000, lat:65.5888 },
            { country:"United States", city:"Alaska", lon:-168.5000, lat:63.2888 },
            { country:"United States", city:"Alaska", lon:-170.9000, lat:63.2888 },
            { country:"United States", city:"Seattle", lon:-122.3321, lat:47.6211 },
            { country:"United States", city:"Seattle", lon:-119.0000, lat:47.6211 },
            { country:"United States", city:"San Francisco", lon:-122.4194, lat:37.7562 },
            { country:"United States", city:"Los Angeles", lon:-118.2437, lat:34.1139 },
            { country:"United States", city:"Denver", lon:-104.9903, lat:39.7621 },
            { country:"United States", city:"Chicago", lon:-87.6298, lat:41.4375 },
            { country:"United States", city:"Houston", lon:-95.3698, lat:29.8863 },
            { country:"United States", city:"Washington, D.C.", lon:-77.0369, lat:38.9047 },
            { country:"United States", city:"New York", lon:-74.0060, lat:40.8343 },
            { country:"United States", city:"New York", lon:-73.2060, lat:40.8343 },
            { country:"United States", city:"New York", lon:-72.0060, lat:41.0343 },
            { country:"Mexico", city:"Mexico City", lon:-99.1332, lat:19.4333 },
            { country:"Cuba", city:"Havana", lon:-82.3666, lat:22.6367 },
            { country:"Colombia", city:"Bogotá", lon:-74.0721, lat:4.7111 },
            { country:"Peru", city:"Lima", lon:-77.0428, lat:-10.0600 },
            { country:"Chile", city:"Santiago", lon:-70.6693, lat:-33.4500 },
            { country:"Argentina", city:"Buenos Aires", lon:-58.3816, lat:-34.0997 },
            { country:"Argentina", city:"Buenos Aires", lon:-53.700, lat:-34.0997 },
            { country:"Brazil", city:"Rio De Janeiro", lon:-41.1729, lat:-21.9083 },
            { country:"Brazil", city:"Rio De Janeiro", lon:-43.1729, lat:-22.9083 },
            { country:"Brazil", city:"Rio De Janeiro", lon:-44.1729, lat:-22.9083 },
            { country:"Brazil", city:"São Paulo", lon:-53.6000, lat:-23.5504 },
            { country:"Brazil", city:"São Paulo", lon:-46.6333, lat:-23.5504 }
          ];

          function nearestCity(lon){
            let best=null, d=999;
            for(const c of CITIES){
              let diff=Math.abs(lon-c.lon);
              if(diff>180) diff=360-diff;
              if(diff<d){ d=diff; best=c; }
            }
            return best;
          }

          const CAM_PITCH = Cesium.Math.toRadians(-90);

          const MIN_RANGE = 1_000;
          const MAX_RANGE = 15_000_000;

          const HOLD_MAX = 10000; // 10초
          const ZOOM_IN = 20000;  // 20초
          const HOLD_MIN = 10000; // 10초
          const ZOOM_OUT = 20000; // 20초

          const TOTAL = HOLD_MAX + ZOOM_IN + HOLD_MIN + ZOOM_OUT;

          /* easeInOut */
          function easeInOut(t){
            return t < 0.5
              ? 16 * t * t * t * t * t
              : 1 - Math.pow(-2 * t + 2, 5) / 2;
          }

          function getPhaseAndRange(){
            const now = performance.now();
            const t = now % TOTAL;

            if(t < HOLD_MAX){
              return {
                phase:"HOLD_MAX", phaseT:0, range:MAX_RANGE
              };
            }

            if(t < HOLD_MAX + ZOOM_IN){
              const p = (t - HOLD_MAX) / ZOOM_IN;
              return {
                phase:"ZOOM_IN", phaseT:p, range: MAX_RANGE + (MIN_RANGE - MAX_RANGE) * easeInOut(p)
              };
            }

            if(t < HOLD_MAX + ZOOM_IN + HOLD_MIN){
              return {
                phase:"HOLD_MIN", phaseT:0, range:MIN_RANGE
              };
            }

            const p = (t - HOLD_MAX - ZOOM_IN - HOLD_MIN) / ZOOM_OUT;
            return {
              phase:"ZOOM_OUT", phaseT:p, range: MIN_RANGE + (MAX_RANGE - MIN_RANGE) * easeInOut(p)
            };
          }

          // ====== LAT 애니메이션 상태 ======
          const HOME_LAT = 0;
          let camLat = HOME_LAT;

          let prevPhase = null;
          let zoomInStartLat = HOME_LAT;
          let targetLat = HOME_LAT;
          let lockCity = null;

          function animate(){
            const nowDate = new Date();

            // lon은 항상 "라이브 자정 경도" (줌과 무관하게 계속 흐름)
            const offset = getMidnightOffsetHours(nowDate);
            const liveLon = normLon180(offsetToLongitude(offset));

            const {
              phase, phaseT, range
            } = getPhaseAndRange();

            // ZOOM_IN 시작 순간에만 "가까운 도시"를 고정해서 그 도시 lat로 이동
            if(phase !== prevPhase){
              if(phase === "ZOOM_IN"){
                zoomInStartLat = camLat;

                lockCity = nearestCity(liveLon);
                targetLat = (lockCity && typeof lockCity.lat === "number") ? lockCity.lat : HOME_LAT;
              }
              prevPhase = phase;
            }

            // lat 이동
            if(phase === "HOLD_MAX"){
              camLat = HOME_LAT;
            }
            if(phase === "ZOOM_IN"){
              camLat = lerp(zoomInStartLat, targetLat, easeInOut(phaseT));
            }
            if(phase === "HOLD_MIN"){
              camLat = targetLat;
            }
            if(phase === "ZOOM_OUT"){
              camLat = lerp(targetLat, HOME_LAT, easeInOut(phaseT));
            }

            viewer.camera.lookAt(
              Cesium.Cartesian3.fromDegrees(liveLon, camLat),
              new Cesium.HeadingPitchRange(0, CAM_PITCH, range)
            );

            // UI
            timeLineEl.textContent = formatMidnightTime();
            dateLineEl.textContent = formatMidnightDate(nowDate);
            lonEl.textContent = formatLongitudeDecimal4(liveLon);

            const cityForLabel =
              (phase === "ZOOM_IN" || phase === "HOLD_MIN" || phase === "ZOOM_OUT")
                ? lockCity
                : nearestCity(liveLon);

            placeEl.textContent = cityForLabel ? `${cityForLabel.country} · ${cityForLabel.city}` : "";

            animateHeadlineLetters();
            requestAnimationFrame(animate);
          }

          animate();
        })();
      </script>
    </body>
</html>
